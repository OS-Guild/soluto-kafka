version: '2.3'

services:
    kafka_consumer_http_target:
        build: ../kafka-consumer-java/
        ports:
            - 4000:4000
        environment:
            - KAFKA_BROKER=kafka:9092
            - TOPICS=test,another-test
            - GROUP_ID=consumer_1
            - SENDING_PROTOCOL=http
            - TARGET=fake-http-server:2000/consume
            - MONITORING_SERVER_PORT=4000

    # kafka_consumer_for_errors:
    #     build: ./kafka-consumer-java/
    #     ports:
    #         - 8000:8000
    #     environment:
    #         - KAFKA_BROKER=kafka:9092
    #         - TOPICS=test,another_test
    #         - GROUP_ID=consumer_for_errors
    #         - SENDING_PROTOCOL=http
    #         - TARGET=non_existent_target
    #         - MONITORING_SERVER_PORT=8000

    # kafka_consumer_grpc_target:
    #     build: ./kafka-consumer-java/
    #     ports:
    #         - 5000:5000
    #     environment:
    #         - KAFKA_BROKER=kafka:9092
    #         - TOPICS=test
    #         - GROUP_ID=consumer_2
    #         - SENDING_PROTOCOL=grpc
    #         - TARGET=fake-grpc-server:4770
    #         - MONITORING_SERVER_PORT=5000

    producer:
        build: ../kafka-producer-java/
        ports:
            - 6000:6000
        environment:
            - PORT=6000
            - KAFKA_BROKER=kafka:9092

    fake-http-server:
        image: soluto/simple-fake-server
        ports:
            - 3000:3000

    fake-grpc-server:
        image: tkpd/gripmock
        ports:
            - 4771:4771
        volumes:
            - ${PWD}/soluto-kafka-grpc-target:/proto
        command: /proto/message.proto